<!DOCTYPE html>
<html lang="en">
<head>
<base href="">
<meta charset="utf-8" />
<title>Trident | Dashboard</title>
<meta name="description" content="Updates and statistics" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
<link href="assets/plugins/custom/fullcalendar/fullcalendar.bundle.css" rel="stylesheet" type="text/css" />
<link href="assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
<link href="assets/plugins/custom/prismjs/prismjs.bundle.css" rel="stylesheet" type="text/css" />
<link href="assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="assets/css/style.css" />
</head>
<body id="kt_body" class="quick-panel-right demo-panel-right offcanvas-right header-fixed header-mobile-fixed aside-enabled aside-static page-loading trident_body">
<div id="kt_header_mobile" class="header-mobile header-mobile-fixed"> <a href="index.html"> <img alt="Logo" src="assets/media/login_trident.png" class="logo-default max-h-30px" /> </a>
  <div class="d-flex align-items-center">
    <button class="btn p-0 burger-icon rounded-0 burger-icon-left" id="kt_aside_tablet_and_mobile_toggle"> <span></span> </button>
    <button class="btn btn-hover-text-primary p-0 ml-3" id="kt_header_mobile_topbar_toggle"> <span class="svg-icon svg-icon-xl">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <polygon points="0 0 24 0 24 24 0 24" />
        <path d="M12,11 C9.790861,11 8,9.209139 8,7 C8,4.790861 9.790861,3 12,3 C14.209139,3 16,4.790861 16,7 C16,9.209139 14.209139,11 12,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
        <path d="M3.00065168,20.1992055 C3.38825852,15.4265159 7.26191235,13 11.9833413,13 C16.7712164,13 20.7048837,15.2931929 20.9979143,20.2 C21.0095879,20.3954741 20.9979143,21 20.2466999,21 C16.541124,21 11.0347247,21 3.72750223,21 C3.47671215,21 2.97953825,20.45918 3.00065168,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
      </g>
    </svg>
    <!--end::Svg Icon--> 
    </span> </button>
  </div>
</div>
<div class="d-flex flex-column flex-root">
  <div class="d-flex flex-row flex-column-fluid page">
    <div class="aside aside-left d-flex flex-column flex-row-auto" id="kt_aside">
      <div class="aside-menu-wrapper flex-column-fluid" id="kt_aside_menu_wrapper">
        <div id="kt_aside_menu" class="aside-menu min-h-lg-800px" data-menu-vertical="1" data-menu-scroll="1" data-menu-dropdown-timeout="500">
          <ul class="menu-nav">
            <li class="menu-section">
              <h4 class="menu-text">Main</h4>
              <i class="menu-icon ki ki-bold-more-hor icon-md"></i> </li>
            <li class="menu-section">
              <h4 class="menu-text">Custom Basket</h4>
              <i class="menu-icon ki ki-bold-more-hor icon-md"></i> </li>
            <li class="menu-section">
              <h4 class="menu-text">Document</h4>
              <i class="menu-icon ki ki-bold-more-hor icon-md"></i> </li>
            <li class="menu-section">
              <h4 class="menu-text">Feedback</h4>
              <i class="menu-icon ki ki-bold-more-hor icon-md"></i> </li>
            <li class="menu-section">
              <h4 class="menu-text">OldCHarts</h4>
              <i class="menu-icon ki ki-bold-more-hor icon-md"></i> </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column flex-row-fluid wrapper" id="kt_wrapper">
      <div id="kt_header" class="header header-fixed">
        <div class="container d-flex align-items-stretch justify-content-between">
          <div class="d-none d-lg-flex align-items-center mr-3"> <a href="index.html"> <img alt="Logo" src="assets/media/login_trident.png" class="logo-sticky max-h-35px" /> </a> </div>
          <div class="topbar">
            <div class="dropdown"> 
              <!--begin::Toggle-->
              <div class="topbar-item mr-4">
                <div><a href="#" class="text-white main_menu">Main</a></div>
              </div>
              <div class="topbar-item mr-4">
                <div><a href="#" class="text-white main_menu">Custom Basket</a></div>
              </div>
              <div class="topbar-item mr-4">
                <div><a href="#" class="text-white main_menu">Document</a></div>
              </div>
              <div class="topbar-item mr-4">
                <div><a href="#" class="text-white main_menu">Feedback</a></div>
              </div>
              <!--<div class="topbar-item mr-4">
                <div><a href="#" class="text-white main_menu">Old Chart</a></div>
              </div>-->
              <div class="dropdown float-right">
                <div class="topbar-item ml-4" data-toggle="dropdown" data-offset="10px,0px">
                  <div class="font-weight-bolder text-white"> <a href="#" class="text-white login_email"> Shagun@hashbrown.com<i class="ki ki-arrow-down ml-4 text-white arrow_down"></i> </a></div>
                </div>
                <div class="dropdown-menu p-0 m-0 dropdown-menu-right dropdown-menu-anim-up dropdown-menu-md mt-4">
                  <ul class="navi navi-hover py-5">
                    <li class="navi-item"> <a href="#" class="navi-link"> <span class="navi-icon"> <i class="flaticon-list"></i> </span> <span class="navi-text">Change Password</span> </a> </li>
                    <li class="navi-item"> <a href="#" class="navi-link"> <span class="navi-icon"> <i class="flaticon-logout"></i> </span> <span class="navi-text">Logout</span> </a> </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
		<div class="d-flex flex-column flex-column-fluid" id="kt_content">
        <div class="container">
          <div class="col-xl-12">
            <div class="quick-search quick-search-inline mb-5">
		 <div class="row">
                <div class="col-lg-8">
                  <div class="quick-search-form">
                    <div class="input-group rounded">
                      <div class="input-group-prepend"> <span class="input-group-text"> <span class="svg-icon svg-icon-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                          <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <rect x="0" y="0" width="24" height="24" />
                            <path d="M14.2928932,16.7071068 C13.9023689,16.3165825 13.9023689,15.6834175 14.2928932,15.2928932 C14.6834175,14.9023689 15.3165825,14.9023689 15.7071068,15.2928932 L19.7071068,19.2928932 C20.0976311,19.6834175 20.0976311,20.3165825 19.7071068,20.7071068 C19.3165825,21.0976311 18.6834175,21.0976311 18.2928932,20.7071068 L14.2928932,16.7071068 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                            <path d="M11,16 C13.7614237,16 16,13.7614237 16,11 C16,8.23857625 13.7614237,6 11,6 C8.23857625,6 6,8.23857625 6,11 C6,13.7614237 8.23857625,16 11,16 Z M11,18 C7.13400675,18 4,14.8659932 4,11 C4,7.13400675 7.13400675,4 11,4 C14.8659932,4 18,7.13400675 18,11 C18,14.8659932 14.8659932,18 11,18 Z" fill="#000000" fill-rule="nonzero" />
                          </g>
                        </svg>
                        </span> </span> </div>
                      <input type="text" class="form-control h-45px" placeholder="Search..." />
                      <div class="nav-item relative_pos w-100" style="display:none">
                        <div class="dropdown_search_bar">
                          <div class="font-size-sm text-primary font-weight-bolder text-uppercase mb-2"> Symbols </div>
                          <div class="d-flex align-items-center flex-grow-1 mb-2">
                            <div class="d-flex flex-column ml-3 mt-2 mb-2"> <a href="#" class="font-weight-bold text-dark text-hover-primary"> AAPL </a> <span class="font-size-sm font-weight-bold text-muted"> Apple Inc. </span> </div>
                          </div>
                          <div class="d-flex align-items-center flex-grow-1 mb-2">
                            <div class="d-flex flex-column ml-3 mt-2 mb-2"> <a href="#" class="font-weight-bold text-dark text-hover-primary"> AMZN </a> <span class="font-size-sm font-weight-bold text-muted"> Amazon.com, Inc. </span> </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="dropdown-menu dropdown-menu-left dropdown-menu-lg dropdown-menu-anim-up">
                    <div class="quick-search-wrapper scroll" data-scroll="true" data-height="350" data-mobile-height="200"></div>
                  </div>
                </div>
                <div class="col-lg-4">
                  <div class="form-group float-right w-100">
                    <div class="row">
                      <div class="col"> <a href="#" class="btn btn-blue text-white w-100 lh-26">Create Basket</a> </div>
                    </div>
                  </div>
                </div>
              </div>

          <div class="col-xl-12 p-0">
			  <div class="quick-search quick-search-inline mb-5">
              <div class="row">
            <div class="col-lg-4 mb-5">
				<div class="card card-custom wave-dark box-border wave">
				 <div class="card-body">
				  <div class="d-flex align-items-center">
				   <div class="d-flex flex-column">
				<div class="row">
					   	<div class="">
					   <span href="#" class="green-text font-weight-bold font-size-h4">Basket One</span>
					<p class="mb-0 mt-2 blue-text">10 Stock</p></div>
					<div class="icons_set">
					   <span class="font-weight-bold">
                    <a href="#"><i class="far fa-eye icon_size pink-text"></i><i style="display:none;" class="far fa-eye-slash icon_size"></i></a>
					<a href="#"><i class="fas fa-pencil-alt ml-2 mr-2 icon_size pink-text"></i></a>
					<a href="#"><i class="far fa-trash-alt icon_size pink-text"></i></a>
               		</span>
					   </div>
					   </div>
				   </div>
				  </div>
				 </div>
				</div>
				</div>
				  <div class="col-lg-4 mb-5">
				<div class="card card-custom wave-dark box-border wave">
				 <div class="card-body">
				  <div class="d-flex align-items-center">
				   <div class="d-flex flex-column">
				<div class="row">
					   	<div class="">
					   <span href="#" class="green-text font-weight-bold font-size-h4">Basket One</span>
					<p class="mb-0 mt-2 blue-text">40 Stock</p></div>
					<div class="icons_set">
					   <span class="font-weight-bold">
                    <a href="#"><i class="far fa-eye icon_size pink-text"></i><i style="display:none;" class="far fa-eye-slash icon_size"></i></a>
					<a href="#"><i class="fas fa-pencil-alt ml-2 mr-2 icon_size pink-text"></i></a>
					<a href="#"><i class="far fa-trash-alt icon_size pink-text"></i></a>
               		</span>
					   </div>
					   </div>
				   </div>
				  </div>
				 </div>
				</div>
				</div>
				   <div class="col-lg-4 mb-5">
				<div class="card card-custom wave-dark box-border wave">
				 <div class="card-body">
				  <div class="d-flex align-items-center">
				   <div class="d-flex flex-column">
				<div class="row">
					   	<div class="">
					   <span href="#" class="green-text font-weight-bold font-size-h4">Basket One</span>
					<p class="mb-0 mt-2 blue-text">10 Stock</p></div>
					<div class="icons_set">
					   <span class="font-weight-bold">
                    <a href="#"><i class="far fa-eye icon_size pink-text"></i><i style="display:none;" class="far fa-eye-slash icon_size"></i></a>
					<a href="#"><i class="fas fa-pencil-alt ml-2 mr-2 icon_size pink-text"></i></a>
					<a href="#"><i class="far fa-trash-alt icon_size pink-text"></i></a>
               		</span>
					   </div>
					   </div>
				   </div>
				  </div>
				 </div>
				</div>
				</div>
				   <div class="col-lg-4 mb-5">
				<div class="card card-custom wave-dark box-border wave">
				 <div class="card-body">
				  <div class="d-flex align-items-center">
				   <div class="d-flex flex-column">
				<div class="row">
					   	<div class="">
					   <span href="#" class="green-text font-weight-bold font-size-h4">Basket One</span>
					<p class="mb-0 mt-2 blue-text">20 Stock</p></div>
					<div class="icons_set">
					   <span class="font-weight-bold">
                    <a href="#"><i class="far fa-eye icon_size pink-text"></i><i style="display:none;" class="far fa-eye-slash icon_size"></i></a>
					<a href="#"><i class="fas fa-pencil-alt ml-2 mr-2 icon_size pink-text"></i></a>
					<a href="#"><i class="far fa-trash-alt icon_size pink-text"></i></a>
               		</span>
					   </div>
					   </div>
				   </div>
				  </div>
				 </div>
				</div>
				</div>
				   <div class="col-lg-4 mb-5">
				<div class="card card-custom wave-dark box-border wave">
				 <div class="card-body">
				  <div class="d-flex align-items-center">
				   <div class="d-flex flex-column">
				<div class="row">
					   	<div class="">
					   <span href="#" class="green-text font-weight-bold font-size-h4">Basket One</span>
					<p class="mb-0 mt-2 blue-text">40 Stock</p></div>
					<div class="icons_set">
					   <span class="font-weight-bold">
                    <a href="#"><i class="far fa-eye icon_size pink-text"></i><i style="display:none;" class="far fa-eye-slash icon_size"></i></a>
					<a href="#"><i class="fas fa-pencil-alt ml-2 mr-2 icon_size pink-text"></i></a>
					<a href="#"><i class="far fa-trash-alt icon_size pink-text"></i></a>
               		</span>
					   </div>
					   </div>
				   </div>
				  </div>
				 </div>
				</div>
				</div>
              </div>
        
          
        </div>
      </div>
			  </div></div></div></div>
    </div>
  </div>
	<div class="footer bg_trident py-4 d-flex flex-lg-column footer_box" id="kt_footer">
            <div class=" text-center">
              <div class="text-dark order-2 order-md-1"> <span class="text-muted font-weight-bold mr-2">Â© 2020</span> <a href="http://keenthemes.com/metronic" target="_blank" class="text-dark-75 text-hover-primary">Trident All rights reserved by Kievanos</a> </div>
            </div>
          </div>
</div>

	
	
<script>var HOST_URL = "https://keenthemes.com/metronic/tools/preview";</script> 
<script>var KTAppSettings = { "breakpoints": { "sm": 576, "md": 768, "lg": 992, "xl": 1200, "xxl": 1200 }, "colors": { "theme": { "base": { "white": "#ffffff", "primary": "#6993FF", "secondary": "#E5EAEE", "success": "#1BC5BD", "info": "#8950FC", "warning": "#FFA800", "danger": "#F64E60", "light": "#F3F6F9", "dark": "#212121" }, "light": { "white": "#ffffff", "primary": "#E1E9FF", "secondary": "#ECF0F3", "success": "#C9F7F5", "info": "#EEE5FF", "warning": "#FFF4DE", "danger": "#FFE2E5", "light": "#F3F6F9", "dark": "#D6D6E0" }, "inverse": { "white": "#ffffff", "primary": "#ffffff", "secondary": "#212121", "success": "#ffffff", "info": "#ffffff", "warning": "#ffffff", "danger": "#ffffff", "light": "#464E5F", "dark": "#ffffff" } }, "gray": { "gray-100": "#F3F6F9", "gray-200": "#ECF0F3", "gray-300": "#E5EAEE", "gray-400": "#D6D6E0", "gray-500": "#B5B5C3", "gray-600": "#80808F", "gray-700": "#464E5F", "gray-800": "#1B283F", "gray-900": "#212121" } }, "font-family": "Poppins" };</script> 
<script src="assets/plugins/global/plugins.bundle.js"></script> 
<script src="assets/plugins/custom/prismjs/prismjs.bundle.js"></script> 
<script src="assets/js/scripts.bundle.js"></script> 
<script src="assets/plugins/custom/fullcalendar/fullcalendar.bundle.js"></script> 
<script src="assets/js/pages/widgets.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script> 
<script src="assets/js/pages/crud/forms/widgets/bootstrap-datepicker.js"></script> 
<script>
    $('.select2').select2();
</script> 
<script>
	$("#type").bind("change", function () {
    $('#historic_date').modal('show')(this.value === 'donations'); 
});
</script> 
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script> 
<!--Trident Bar chart--> 

<script>
	var svg = d3.select("svg");
	var margin = {top: 10, right: 10, bottom:20, left: 100};
 	var width = parseInt(d3.select("#bar_chart").style("width")) - margin.left - margin.right,
    height = parseInt(d3.select("#bar_chart").style("height")) - margin.top - margin.bottom;
	
	var formatPercent = d3.format("");
	
	var x = d3.scale.ordinal()  
    .rangeRoundBands([0, width], .1)
	var xAxis = d3.svg.axis()
	.scale(x)
	.orient("bottom");
	
	var y = d3.scale.linear()
	.range([height, 0]);
	var yAxis = d3.svg.axis()
	.scale(y)
	.orient("left")
	.ticks("5")
	.tickFormat(function(d) {return d + "%"});
	
	
		var Tooltip = d3.select("#bar_chart")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    
		
		
	var mouseover = function(d) {
    Tooltip
      .style("opacity", 1)
    d3.select(this)
      .style("opacity", 1)
  }
  var mousemove = function(d) {
    Tooltip
      .text(d.year + ":" + d.value + "%")
      .style("left", (d3.mouse(this)[0]+70) + "px")
      .style("top", (d3.mouse(this)[1]) + "px")
	  .style("font-weight", "600")
  }
  var mouseleave = function(d) {
    Tooltip
      .style("opacity", 0)
    d3.select(this)
  }
	
	var svg = d3.select("#bar_chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	d3.csv("TridentLive.csv", function(error, data){
    x.domain(data.map(function(d) {
        return d.year;
    }));
    y.domain(d3.extent(data, function(d) {
        return d.value;
    }));

	
		
   svg.append("g")
  .attr("class", "line")
  .append("line")
  .attr("y1", y(0))
  .attr("y2", y(0))
  .attr("x1", 0)
  .attr("x2", width);

    svg.selectAll(".bar")
        .data(data)
        .enter().append("rect")
        .attr("class", function(d) {
			if (d.value < 0){
                return "bar negative";
            } else {
                return "bar positive";
            }})
        .attr("data-yr", function(d){
            return d.year;
        })
        .attr("data-c", function(d){
            return d.value;
        })
        .attr("title", function(d){
            return (d.year + ": " + d.value + " %")
        })
        .attr("y", function(d) {

            if (d.value > 0){
                return y(d.value);
            } else {
                return y(0);
            }

        })
        .attr("x", function(d) {
            return x(d.year);
	
        })
        .attr("width", x.range())
        .attr("height", function(d) {
            return Math.abs(y(d.value) - y(0));
        })
        /*.on("mouseover", function(d){
            d3.select("#_yr")
                .text("" + d.year);
            d3.select("#degrree")
                .text(d.value + "%");
        })*/
	
		.on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave)
		
  
  
		svg.append("g")
			.attr("class", "y axis")
			.call(yAxis);


      
 
	
		svg.append("g")
			.attr("class", "X axis")
			.attr("transform", "translate(" + (margin.right - 0) + "," + height +  ")")
	.attr("transform", "translate(0,270)")
			.call(xAxis);

		svg.append("g")
			.attr("class", "infowin")
			.attr("transform", "translate(50, 0)")
			.append("text")
			.attr("id", "_yr");
	
svg.append("g")
        .attr("transform", "translate(0," + height + ")")
	  .append("text")
		.attr("class", "xAxis-text")
	
		svg.append("g")
			.attr("class", "infowin")
			.attr("transform", "translate(90, 0)")
			.append("text")
			.attr("id","degrree");
		svg.selectAll(".text")  		
		  .data(data)
		  .enter()
		  .append("text")
		  .attr("class","label")
		  .attr("x", (function(d) { return x(d.year)}  ))
		  .attr("y", function(d) { return y(d.value) })
		  .attr("dx", "3")
		 .attr("dy", "0")
		  .text(function(d) { return d.value + "%" });
		
	
		
		
	function type(d) 
		{
			d.value = +d.value;
			return d;
		};
	});

		
</script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script> 
<script src="https://d3js.org/d3.v3.min.js"></script> 
<script>
	var count;
	var month;
	var price;var value_negative;
	var obj=[{"count":2,"month":"2001-07", "price":100, "value_negative": -1},{"count":3,"month":"2002-09","price":130,  "value_negative": -1},{"count":1,"month":"2003-06","price":200,  "value_negative": -1},{"count":2,"month":"2004-06","price":190,  "value_negative": -3},{"count":2,"month":"2005-06","price":290,  "value_negative": -3},{"count":1,"month":"2006-07","price":100, "value_negative": -1},{"count":2,"month":"2007-07", "price":100, "value_negative": -2},{"count":3,"month":"2008-09","price":130,  "value_negative": -1},{"count":1,"month":"2009-06","price":200,  "value_negative": -3},{"count":2,"month":"2010-06","price":190,  "value_negative": -3},{"count":2,"month":"2011-06","price":290,  "value_negative": -2},{"count":2,"month":"2012-07","price":100, "value_negative": -3}]
var optwidth = 1006;
var optheight = 370;
var dataset = [];
	
	
dataset=obj;
dataset.forEach(function(d) {
    d.month = d3.time.format("%Y-%d").parse(d.month);
});

dataset.sort(function(x, y){
   return d3.ascending(x.month, y.month);
});

var margin	= {top: 20, right: 30, bottom: 100, left: 30},
    width	= optwidth - margin.left - margin.right,
    height	= optheight - margin.top - margin.bottom;

var margin_context = {top: 320, right: 30, bottom: 20, left: 20},
    height_context = optheight - margin_context.top - margin_context.bottom;

var dataXrange = d3.extent(dataset, function(d) { return d.month; });

var dataYrange = d3.extent(dataset, function(d) { return d.count; });
   
var mindate = dataXrange[0], 
    maxdate = dataXrange[1];

var DateFormat = d3.time.format("%m/%d/%Y");

var dynamicDateFormat = timeFormat([
    [d3.time.format("%Y"), function() { return true; }],
    [d3.time.format("%d/%y"), function(d) { return d.getMonth(); }],
    [function(){return ""}, function(d) { return d.getDate() != 1;}]]);

var x = d3.time.scale()
	.range([0, (width)])
    .domain(dataXrange);

var y = d3.scale.linear()
	.range([height, 0])
    .domain(dataYrange)

var xAxis = d3.svg.axis()
	.scale(x)
    .orient("bottom")
	.tickSize(-(height))
    .ticks(customTickFunction)
    .tickFormat(dynamicDateFormat);

var yAxis = d3.svg.axis()
	.scale(y)
    .tickSize((width)).ticks(6).tickFormat(function(d) {return d + "%"})
	.orient("left");
	
var yRight = d3.scale.linear()
	.range([height, 0])
    .domain([(0), d3.max(dataset, function(d) { return d.price; })]);

var yAxisRight = d3.svg.axis()
	.scale(yRight)
   .ticks(6) .tickFormat(function(d) {return "$" + d })
	.orient("right");

	
var x2 = d3.time.scale()
    .range([0, width])
    .domain([mindate, maxdate]);

var y2 = d3.scale.linear()
	.range([height_context, 0])
    .domain(y.domain());

var xAxis_context = d3.svg.axis()
    .scale(x2)
    .orient("bottom")
    .ticks(customTickFunction)
    .tickFormat(dynamicDateFormat);

var line = d3.svg.line()
	.x(function(d) { return x(d.month); })
	.y(function(d) { return y(d.count); })

var area = d3.svg.area()
  .x(function(d) { return x(d.month); })
  .y0((height))
  .y1(function(d) { return y(d.count); });

var area_context = d3.svg.area()
    .x(function(d) { return x2(d.month); })
    .y0((height_context))
    .y1(function(d) { return y2(d.count); });

var line_context = d3.svg.line()
    .x(function(d) { return x2(d.month); })
    .y(function(d) { return y2(d.count); });

	
  
var brush = d3.svg.brush()
    .x(x2)
    .on("brush", brushed)
    .on("brushend", brushend);

var zoom = d3.behavior.zoom()
    .on("zoom", draw)
    .on("zoomend", brushend);

var vis = d3.select("#line_chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  	.attr("class", "metric-chart"); 

vis.append("defs").append("clipPath")
    .attr("id", "clip")
    .append("rect")
    .attr("width", width)
    .attr("height", height);

var context = vis.append("g")
    .attr("class", "context")
    .attr("transform", "translate(" + margin_context.left + "," + margin_context.top + ")");

var focus = vis.append("g")
    .attr("class", "focus")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var rect = vis.append("svg:rect")
    .attr("class", "pane")
    .attr("width", width)
    .attr("height", height)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .call(zoom)
    .call(draw);
	

	
focus.append("g")
    .attr("class", "y axis")
    .call(yAxis)
   	.attr("transform", "translate(" + (width) + ", 0)");

	
	
	

		
	   focus.append("path")
        .datum(dataset)
	.attr("fill", "#333")
     .attr("class", "")
		.attr("d", area)
        .attr("d", d3.svg.area()
         .x(function(d) { return x(d.month);})
	    .y0(function(d) { return yRight(0)})  
 		.y1(function(d) { return yRight(d.price); }));
	
	


	
focus.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(5," + height +  ")")
    .call(xAxis);

	focus.append("g")				
.attr("class", "y axis")	
.attr("transform", "translate(" + width + " , 0)")	
.call(yAxisRight);
	  


	
focus.append("path")
    .datum(dataset)
        .attr("class", "line_positive").attr("d", line)
        .attr("d", d3.svg.line()
        .x(function(d) { return x(d.month); })
   .y(function(d) { if (d.count>0) {return y(d.count)}else{return y(0)} }));
		

	
	focus.append("path")
    .datum(dataset)
        .attr("class", "line_negative") .attr("d", line)
        .attr("d", d3.svg.line()
           .x(function(d) { return x(d.month); })
   .y(function(d) { if (d.value_negative<0) {return y(d.value_negative)}else{return y(0)}}));
	
    focus.append("path")
        .datum(dataset)
     .attr("class", "positiveLine")
		.attr("d", area)
        .attr("d", d3.svg.area()
            .x(function(d) { return x(d.month); })
  .y0(function(d) { return y(0) })
   .y1(function(d) { if (d.count>0) {return y(d.count)}else{return y(0)} }));

    focus.append("path")
        .datum(dataset)
        .attr("class", "negativeLine")
	.attr("d", area)
        .attr("d", d3.svg.area()
            .x(function(d) { return x(d.month) })
            .y0(function(d) { return y(0) })
            .y1(function(d) { if (d.value_negative<0) {return y(d.value_negative)}else{return y(0)} }));
        

	 	

context.append("path")
    .datum(dataset)
    .attr("class", "area")
    .attr("d", area_context)
	;

/*context.append("path")
    .datum(dataset)
    .attr("class", "line")
    .attr("d", line_context )*/
	

context.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + height_context + ")")
    .call(xAxis_context);

var brushg = context.append("g")
    .attr("class", "x brush")
    .call(brush);

brushg.selectAll(".extent")
   .attr("y", -6)
   .attr("height", height_context + 8);

brushg.selectAll(".resize")
    .append("rect")
    .attr("class", "handle")
    .attr("transform", "translate(0," +  -3 + ")")
    .attr('rx', 2)
	.attr('ry', 2)
    .attr("height", height_context + 6)
    .attr("width", 3);

brushg.selectAll(".resize")
    .append("rect")
    .attr("class", "handle-mini")
    .attr("transform", "translate(-2,8)")
    .attr('rx', 3)
    .attr('ry', 3)
    .attr("height", (height_context/2))
    .attr("width", 7);

vis.append("text")
    .attr("class", "y axis title")
    .text("Strong")
    .attr("x", (-(height/4)))
    .attr("y", 2)
	.style("font-size", "11")
	.style("fill","#40c4ff")
    .attr("dy", ".6em")
    .attr("transform", "rotate(-90)")
    .style("text-anchor", "top");
	zoom.x(x);
	
	vis.append("text")
    .attr("class", "y axis title")
    .text("Weak")
    .attr("x", (-(height/1)))
    .attr("y", 2)
	.style("font-size", "10")
	.style("fill","#FF4497")
    .attr("dy", ".6em")
    .attr("transform", "rotate(-90)")
    .style("text-anchor", "bottom");
	zoom.x(x);


	
	
function timeFormat(formats) {
  return function(date) {
    var i = formats.length - 1, f = formats[i];
    while (!f[1](date)) f = formats[--i];
    return f[0](date);
  };
};

function customTickFunction(t0, t1, dt)  {
    var labelSize = 28; //
    var maxTotalLabels = Math.floor(width / labelSize);

    function step(date, offset)
    {
        date.setMonth(date.getMonth() + offset);
    }
	var time = d3.time.month.ceil(t0), times = [], monthFactors = [1,3,15];
	while (time < t1) times.push(new Date(+time)), step(time, 1);
    var timesCopy = times;
    var i;
    for(i=0 ; times.length > maxTotalLabels ; i++)
        times = _.filter(timesCopy, function(d){
            return (d.getMonth()) % monthFactors[i] == 0;
        });
	return times;
};

function brushed() {
	x.domain(brush.empty() ? x2.domain() : brush.extent());
    focus.select(".negativeLine ").attr("d", area)
	.attr("class", " negativeLine")
	.attr("fill", "#FF4497")
	.attr("d", area)
        .attr("d", d3.svg.area()
            .x(function(d) { return x(d.month) })
            .y0(function(d) { return y(0) })
            .y1(function(d) { if (d.value_negative<0) {return y(d.value_negative)}else{return y(0)} }));
	
        focus.select(".positiveLine ").attr("d", area)
	.attr("fill", "#40c4ff").attr("d", area)
        .attr("d", d3.svg.area()
            .x(function(d) { return x(d.month); })
  .y0(function(d) { return y(0) })
   .y1(function(d) { if (d.count>0) {return y(d.count)}else{return y(0)} }));
	
	focus.select(".line_positive").attr("d", line)
	.attr("d", d3.svg.line()
	.x(function(d) { return x(d.month); })
   .y(function(d) { if (d.count>0) {return y(d.count)}else{return y(0)} }));
	
	focus.select(".line_negative").attr("d", line)
	.attr("d", d3.svg.line()
	.x(function(d) { return x(d.month); })
   .y(function(d) { if (d.value_negative<0) {return y(d.value_negative)}else{return y(0)} }));


    focus.select(".x.axis").call(xAxis);
    zoom.x(x);
    updateDisplayDates();
    setYdomain();
};

function draw() {
    setYdomain();
    focus.select(".negativeLine ").attr("d", area)
	.attr("class", " negativeLine")
	.attr("fill", "#FF4497")
	.attr("d", area)
        .attr("d", d3.svg.area()
            .x(function(d) { return x(d.month) })
            .y0(function(d) { return y(0) })
            .y1(function(d) { if (d.value_negative<0) {return y(d.value_negative)}else{return y(0)} }));
        
	focus.select(".positiveLine ").attr("d", area)
	.attr("fill", "#40c4ff").attr("d", area)
        .attr("d", d3.svg.area()
            .x(function(d) { return x(d.month); })
  .y0(function(d) { return y(0) })
   .y1(function(d) { if (d.count>0) {return y(d.count)}else{return y(0)} }) );
			  		  
	
    
	focus.select(".line_positive").attr("d", line)
	.attr("d", d3.svg.line()
	.x(function(d) { return x(d.month); })
   .y(function(d) { if (d.value_negative>0) {return y(d.value_negative)}else{return y(0)} }));
	
	focus.select(".line_negative").attr("d", line)
	.attr("d", d3.svg.line()
	.x(function(d) { return x(d.month); })
   .y(function(d) { if (d.count<0) {return y(d.count)}else{return y(0)} }));
    focus.select(".x.axis").call(xAxis);
    brush.extent(x.domain());
    vis.select(".brush").call(brush);
    updateDisplayDates();
	
};
	
function brushend() {
    var b = brush.extent();
    var out_of_bounds = brush.extent().some(function(e) { return e < mindate | e > maxdate; });
    if (out_of_bounds){ b = moveInBounds(b) };
};

function updateDisplayDates() {
	var b = brush.extent();
    var localBrushDateStart = (brush.empty()) ? DateFormat(dataXrange[0]) : DateFormat(b[0]),
        localBrushDateEnd   = (brush.empty()) ? DateFormat(dataXrange[1]) : DateFormat(b[1]);
	d3.select("#displayDates")
        .text(localBrushDateStart == localBrushDateEnd ? localBrushDateStart : localBrushDateStart + " - " + localBrushDateEnd);
};

function moveInBounds(b) {
    var ms_in_year = 31536000000,
        brush_start_new,
        brush_end_new;

    if (b[0] < mindate) { brush_start_new = mindate; }
    else if (b[0] > maxdate){ brush_start_new = new Date(maxdate.getTime() - ms_in_year); }
    else { brush_start_new = b[0]; };
	if (b[1] > maxdate)   { brush_end_new = maxdate; }
    else if (b[1] < mindate) { brush_end_new = new Date(mindate.getTime() + ms_in_year); }
    else { brush_end_new = b[1]; };

    brush.extent([brush_start_new, brush_end_new]);
    brush(d3.select(".brush").transition());
    brushed();
    draw();
    return(brush.extent())
};

function setYdomain(){
    var xleft = new Date(x.domain()[0]);
    var xright = new Date(x.domain()[1]);
	var bisectDate = d3.bisector(function(d) { return d.month; }).right;
    var iL = bisectDate(dataset, xleft);
    if (dataset[iL] !== undefined && dataset[iL-1] !== undefined) {

        var left_dateBefore = dataset[iL-1].month,
            left_dateAfter = dataset[iL].month;

        var intfun = d3.interpolateNumber(dataset[iL-1].count, dataset[iL].count);
        var yleft = intfun((xleft-left_dateBefore)/(left_dateAfter-left_dateBefore));
    } else {
        var yleft = 0;
    }

    var iR = bisectDate(dataset, xright);

    if (dataset[iR] !== undefined && dataset[iR-1] !== undefined) {

        var right_dateBefore = dataset[iR-1].month,
            right_dateAfter = dataset[iR].month;

        var intfun = d3.interpolateNumber(dataset[iR-1].count, dataset[iR].count);
        var yright = intfun((xright-right_dateBefore)/(right_dateAfter-right_dateBefore));
    } else {
        var yright = 0;
    }
    var dataSubset = dataset.filter(function(d){ return d.month >= xleft && d.month <= xright; });
    var countSubset = [];
    dataSubset.map(function(d) {countSubset.push(d.count);});
    countSubset.push(yleft);
    countSubset.push(yright);
    var ymax_new = d3.max(countSubset);

    if(ymax_new == 0){
        ymax_new = dataYrange[1];
    }

	y.range([height, 0])
    y.domain([(-5), d3.max(dataset, function(d) { return d.count; })])
    focus.select(".y.axis").call(yAxis);
	
	
	
		var tooltip= vis.append("g")
	.attr("class", "focus_tips")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	
	


	    tooltip.append("line")
        .attr("class", "x")
        .style("stroke", "#FFFF4C")
        .style("stroke-width", "2")
        .style("opacity", 1)
        .attr("y1", 0)
        .attr("y2", height);
        tooltip.append("rect")
            .attr("class", "hover_bg")
            .attr("width", 135)
            .attr("height", 77)
            .attr("x", -30)
            .attr("y", 0)
            .attr("rx", 4)
            .attr("ry", 4);

tooltip.append("text")
            .attr("x", -20)
            .attr("y", 20)
            .text("Date:");
	tooltip.append("text")
            .attr("x", -20)
            .attr("y", 35)
	.attr("class", "y4")
            .text("Positive Value:");
	tooltip.append("text")
            .attr("x", -20)
            .attr("y", 50)
            .text("Negative Value:");
	
		tooltip.append("text")
            .attr("x", -20)
            .attr("y", 65)
            .text("Close Price:");
	
        tooltip.append("text")
            .attr("class", "tooltip-date")
            .attr("x", 50)
            .attr("y", 20);

        
        tooltip.append("text")
            .attr("class", "tooltip-likes")
            .attr("x", 50)
            .attr("y", 35);
  tooltip.append("text")
            .attr("class", "y4 tooltip-neg")
            .attr("x", 50)
            .attr("y", 50)
	
 tooltip.append("text")
            .attr("class", "tooltip-price")
            .attr("x", 50)
            .attr("y", 65);
        vis.append("rect")
            .attr("class", "overlay")
            .attr("width", width)
            .attr("height", height)
	 .on("mouseover", function() { tooltip.style("display", "block"); })
            .on("mouseout", function() { tooltip.style("display", "none"); })
            .on("mousemove", mousemove)
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        function mousemove() {
            var x0 = x.invert(d3.mouse(this)[0]),
                i = bisectDate(dataset, x0, 1),
                d0 = dataset[i - 1],
                d1 = dataset[i],
                d = x0 - d0.month > d1.month - x0 ? d1 : d0;
         tooltip.attr("transform", "translate(" + x(d.month) + "," + y(d.count) + ")");
            tooltip.select(".tooltip-date").text(DateFormat(d.month));
            tooltip.select(".tooltip-likes").text((d.count));
			tooltip.select(".tooltip-neg").text((d.value_negative));
				tooltip.select(".tooltip-price").text((d.price));
		
	
        }
		
};

</script> 
<script src="https://d3js.org/d3.v3.js"></script> 
<script>
var margin = {top: 20, right: 20, bottom: 30, left: 50},
width = 1006 - margin.left - margin.right,
height = 339 - margin.top - margin.bottom;

 var x = d3.scale.linear()
.range([0, width]);
  var xAxis = d3.svg.axis()
.scale(x)
.orient("bottom");
	
   var y = d3.scale.linear()
.range([height, 0]);
var yAxis = d3.svg.axis()
.scale(y)
.orient("left");

 var linePink = d3.svg.line()
.interpolate("monotone")
.x(function(d) { return x(d.X); })
.y(function(d) { return y(d.Y); });

var lineBlue = d3.svg.line() 
.interpolate("monotone")
.x(function(d) { return x(d.X); })
.y(function(d) { return y(d.Y); });


	
	
	
 var svg = d3.select("#normal_density").append("svg")
.attr("width", width + margin.left + margin.right )
.attr("height", height + margin.top + margin.bottom)
 .append("g")
.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

 d3.csv("density_Unicurve.csv", function(error, data) {
data.forEach(function(d, i) {
		d.X = +d.X;
		d.Y = +d.Y;
		});console.log(data);

  
    x.domain(d3.extent(data, function(d) { return d.X; }));
y.domain([0, d3.max(data, function(d) { return d.Y;})]);
	var StreightlineBlue = d3.svg.line()
	.x(function(d) { return x(d.X1); })
.y(function(d) { return y(d.Y1); });
	var StreightlinePink = d3.svg.line()  
.x(function(d) { return x(d.X1); })
.y(function(d) { return y(d.Y1); });	 
   svg.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + height + ")")
  .call(xAxis);

   svg.append("g")
  .attr("class", "y axis")
  .call(yAxis)
	 
 svg
      .append("path")
      .datum(data) 
       .attr("class", "line_blue").attr("d", lineBlue)
      .attr("d", d3.svg.line()
        .x(function(d) { return x(d.X) })
        .y(function(d) { return y(d.Y) })
        )
	 
	svg
      .append("path")
      .datum(data)
       .attr("class", "line_pink").attr("d", linePink)
      .attr("d", d3.svg.line()
        .x(function(d) { return x(d.X) })
        .y(function(d) { return y(d.Y) })
        )
 
	 
var lineOne =[]; 
data.forEach(function(d,i) 
{ 
	if(d.X === -0.028713814 || d.Y === 14.82597127){
		lineOne.push(d);
}
});
svg.append("path")
	 .data(data)
	 .attr("stroke-width", 7)
	 .attr("stroke-linejoin", "round")
	 .attr("stroke-linecap", "round")	
	 .attr("class", "StreightlineBlue")
	 .attr("d", StreightlineBlue(lineOne));

	 
svg.append("text")
    .attr("class", "y axis title")
    .text("Frequency")
    .attr("x", (-(height/2)))
    .attr("y", -17)
	.style("font-size", "11")
	 .style("stroke-width", "0")
	.style("fill","#ffffff")
    .attr("dy", ".6em")
    .attr("transform", "rotate(-90)")
    .style("text-anchor", "middle");
 svg.append("text")             
      .attr("transform", "translate(" + (width) + "," +  (height + margin.top + 0) + ")")
      .style("text-anchor", "end")
	 .style("font-size", "11")
	 .style("stroke-width", "0")
	.style("fill","#ffffff")
      .text("Rp");
	 svg.append("text")     
        .attr("x", 0)
        .attr("y", 310)
        .style("text-anchor", "end")
	 .style("font-size", "11")
	 .style("stroke-width", "0")
	.style("fill","#ffffff")
        .text("Rn");
 });

</script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script> 
<script src="https://d3js.org/d3.v3.min.js"></script> 
<script>


	var value;
	var date;
	var average;
	var obj=[{"value":1,"date":"2001-06-02","average":2}, {"value":-0.3,"date":"2001-06-04","average":2 }, {"value":3,"date":"2001-06-10","average": 2}, {"value":-2,"date":"2001-06-12","average": 2}, {"value":3,"date":"2001-06-16","average":2}, {"value":1,"date":"2001-06-22","average":2}]
	
	
var optwidth = 1006;
var optheight = 290;
var dataset = [];
	
	
dataset=obj;
dataset.forEach(function(d) {
    d.date = d3.time.format("%Y-%m-%d").parse(d.date);
});

dataset.sort(function(x, y){
   return d3.ascending(x.date, y.date);
});

var margin	= {top: 20, right: 30, bottom: 100, left: 20},
    width	= optwidth - margin.left - margin.right,
    height	= optheight - margin.top - margin.bottom;

var margin_context = {top: 320, right: 30, bottom: 20, left: 20},
    height_context = optheight - margin_context.top - margin_context.bottom;

var dataXrange = d3.extent(dataset, function(d) { return d.date; });
var dataYrange = [0, d3.max(dataset, function(d) { return d.value; })];

   
var mindate = dataXrange[0], 
    maxdate = dataXrange[1];

var DateFormat = d3.time.format("%m/%d/%Y");

var dynamicDateFormat = timeFormat([
    [d3.time.format("%Y"), function() { return true; }],
    [d3.time.format("%d/%y"), function(d) { return d.getMonth(); }],
    [function(){return "";}, function(d) { return d.getDate() != 1;}]]);

var x = d3.time.scale()
	.range([0, (width)])
    .domain(dataXrange);

var y = d3.scale.linear()
	.range([height, 0])
    .domain([(0), d3.max(dataset, function(d) { return d.value; })])

var xAxis = d3.svg.axis()
	.scale(x)
    .orient("bottom")
	.tickSize(-(height))
    .ticks(customTickFunction)
    .tickFormat(dynamicDateFormat);

var yAxis = d3.svg.axis()
	.scale(y)
    .tickSize((width)).ticks(6).tickFormat(function(d) {return d + "%"})
	.orient("left");
	

var x2 = d3.time.scale()
    .range([0, width])
    .domain([mindate, maxdate]);

var y2 = d3.scale.linear()
	.range([height_context, 0])
    .domain(y.domain());

var xAxis_context = d3.svg.axis()
    .scale(x2)
    .orient("bottom")
    .ticks(customTickFunction)
    .tickFormat(dynamicDateFormat);

var line = d3.svg.line()
	.x(function(d) { return x(d.date); })
	.y(function(d) { return y(d.value); })

var line_average = d3.svg.line()
	.x(function(d) { return x(d.date); })
	.y(function(d) { return y(d.average); })

var area = d3.svg.area()
  .x(function(d) { return x(d.date); })
  .y0((height))
  .y1(function(d) { return y(d.value); });

var area_context = d3.svg.area()
    .x(function(d) { return x2(d.date); })
    .y0((height_context))
    .y1(function(d) { return y2(d.value); });

var line_context = d3.svg.line()
    .x(function(d) { return x2(d.date); })
    .y(function(d) { return y2(d.value); });

	
  
var brush = d3.svg.brush()
    .x(x2)
    .on("brush", brushed)
    .on("brushend", brushend);

var zoom = d3.behavior.zoom()
    .on("zoom", draw)
    .on("zoomend", brushend);

var vis = d3.select("#spy_chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  	.attr("class", "metric-chart"); 

vis.append("defs").append("clipPath")
    .attr("id", "clip")
    .append("rect")
    .attr("width", width)
    .attr("height", height);


var focus = vis.append("g")
    .attr("class", "focus")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var rect = vis.append("svg:rect")
    .attr("class", "pane")
    .attr("width", width)
    .attr("height", height)
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .call(zoom)
    .call(draw);

  	
  
focus.append("g")
    .attr("class", "y axis")
    .call(yAxis)
   	.attr("transform", "translate(" + (width) + ", 0)");

	
	
	
focus.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(5," + height +  ")")
    .call(xAxis);

	focus.append("path")
    .datum(dataset)
        .attr("class", "line_average") .attr("d", line_average)
	
  

	
focus.append("path")
    .datum(dataset)
        .attr("class", "line_valueGreen").attr("d", line)

    

vis.append("text")
	zoom.x(x);
	
	
	

	
	
function timeFormat(formats) {
  return function(date) {
    var i = formats.length - 1, f = formats[i];
    while (!f[1](date)) f = formats[--i];
    return f[0](date);
  };
};

function customTickFunction(t0, t1, dt)  {
    var labelSize = 28; //
    var maxTotalLabels = Math.floor(width / labelSize);

    function step(date, offset)
    {
        date.setMonth(date.getMonth() + offset);
    }
	var time = d3.time.month.ceil(t0), times = [], monthFactors = [1,3,15];
	while (time < t1) times.push(new Date(+time)), step(time, 1);
    var timesCopy = times;
    var i;
    for(i=0 ; times.length > maxTotalLabels ; i++)
        times = _.filter(timesCopy, function(d){
            return (d.getMonth()) % monthFactors[i] == 0;
        });
	return times;
};

function brushed() {
	x.domain(brush.empty() ? x2.domain() : brush.extent());
   
	
	focus.select(".line_valueGreen").attr("d", line)
	
	
	focus.select(".line_average").attr("d", line_average)

    focus.select(".x.axis").call(xAxis);
    zoom.x(x);
    updateDisplayDates();
    setYdomain();
};

function draw() {
    setYdomain();
   
			  		  
	
    
	focus.select(".line_valueGreen").attr("d", line)
	
	
	focus.select(".line_average").attr("d", line_average)
	
    focus.select(".x.axis").call(xAxis);
    brush.extent(x.domain());
    vis.select(".brush").call(brush);
    updateDisplayDates();
	
};
	
function brushend() {
    var b = brush.extent();
    var out_of_bounds = brush.extent().some(function(e) { return e < mindate | e > maxdate; });
    if (out_of_bounds){ b = moveInBounds(b) };
};

function updateDisplayDates() {
	var b = brush.extent();
    var localBrushDateStart = (brush.empty()) ? DateFormat(dataXrange[0]) : DateFormat(b[0]),
        localBrushDateEnd   = (brush.empty()) ? DateFormat(dataXrange[1]) : DateFormat(b[1]);
	d3.select("#displayDates")
        .text(localBrushDateStart == localBrushDateEnd ? localBrushDateStart : localBrushDateStart + " - " + localBrushDateEnd);
};

function moveInBounds(b) {
    var ms_in_year = 31536000000,
        brush_start_new,
        brush_end_new;

    if (b[0] < mindate) { brush_start_new = mindate; }
    else if (b[0] > maxdate){ brush_start_new = new Date(maxdate.getTime() - ms_in_year); }
    else { brush_start_new = b[0]; };
	if (b[1] > maxdate)   { brush_end_new = maxdate; }
    else if (b[1] < mindate) { brush_end_new = new Date(mindate.getTime() + ms_in_year); }
    else { brush_end_new = b[1]; };

    brush.extent([brush_start_new, brush_end_new]);
    brush(d3.select(".brush").transition());
    brushed();
    draw();
    return(brush.extent())
};

function setYdomain(){
    var xleft = new Date(x.domain()[0]);
    var xright = new Date(x.domain()[1]);
	var bisectDate = d3.bisector(function(d) { return d.date; }).right;
    var iL = bisectDate(dataset, xleft);
    if (dataset[iL] !== undefined && dataset[iL-1] !== undefined) {

        var left_dateBefore = dataset[iL-1].date,
            left_dateAfter = dataset[iL].date;

        var intfun = d3.interpolateNumber(dataset[iL-1].value, dataset[iL].value);
        var yleft = intfun((xleft-left_dateBefore)/(left_dateAfter-left_dateBefore));
    } else {
        var yleft = 0;
    }

    var iR = bisectDate(dataset, xright);

    if (dataset[iR] !== undefined && dataset[iR-1] !== undefined) {

        var right_dateBefore = dataset[iR-1].date,
            right_dateAfter = dataset[iR].date;

        var intfun = d3.interpolateNumber(dataset[iR-1].value, dataset[iR].value);
        var yright = intfun((xright-right_dateBefore)/(right_dateAfter-right_dateBefore));
    } else {
        var yright = 0;
    }
    var dataSubset = dataset.filter(function(d){ return d.date >= xleft && d.date <= xright; });
    var countSubset = [];
    dataSubset.map(function(d) {countSubset.push(d.value);});
    countSubset.push(yleft);
    countSubset.push(yright);
    var ymax_new = d3.max(countSubset);

    if(ymax_new == 0){
        ymax_new = dataYrange[1];
    }

   /* y.domain([-3 , ymax_new*1])*/
	y.range([height, 0])
    y.domain([(-2), d3.max(dataset, function(d) { return d.value; })])

    focus.select(".y.axis").call(yAxis);

    }                   


</script>
</body>
<!--end::Body-->

</html>